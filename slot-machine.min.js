"use strict";function SlotMachine(t,e,n,i){var u=this,h=24;if(u.options=Object.assign({reelHeight:1200,reelWidth:200,reelOffset:20,slotYAxis:0,animSpeed:1e3,sounds:{reelsBegin:null,reelsEnd:null},rngFunc:function(){return Math.random()}},i),!(0<e.length))throw new Error("Failed to initialize (missing reels)");var o=document.createElement("div");o.classList.add("display");for(var s=0;s<e.length;s++){var r=document.createElement("div");r.style.transform="rotateY("+u.options.slotYAxis+"deg)",r.classList.add("reel"),o.appendChild(r)}o.addEventListener("click",l),t.appendChild(o);var a=document.createElement("div");function l(){var o=[];n&&(o.push=function(){Array.prototype.push.apply(this,arguments),o.length===e.length&&window.setTimeout(function(){u.isAnimating=!1,n(o)},u.options.animSpeed)}),c(u.options.sounds.reelsBegin),e.forEach(function(t){var e=function(t){for(var e=0,n=t.length,i=0;i<n;i++)e+=t[i].weight;for(var o=d()*e,s=0;s<n;s++){var r=t[s],a=r.weight;if(o<a)return r;o-=a}}(t.symbols),n=e.position,i=t.element;i.classList.remove("stop"),i.classList.toggle("spin"),i.childNodes.forEach(function(t,e){t.style.backgroundPositionY=f(e,n)+"px"}),window.setTimeout(function(){i.classList.replace("spin","stop"),c(u.options.sounds.reelsEnd),o.push(e)},u.options.animSpeed*function(t,e){void 0===t&&(t=1);void 0===e&&(e=10);t=Math.ceil(t),e=Math.floor(e);return Math.floor(d()*(Math.floor(e)-t))+t}(1,4))})}function d(){return u.options.rngFunc()}function f(t,e){return-Math.abs(m()*t+(e-u.options.reelOffset))}function m(){return u.options.reelHeight/h}function c(t){var e;t&&((e=new Audio).src=t,e.onerror=function(){return console.warn("Failed to load audio: "+t)},e.play())}return a.classList.add("slots"),e.forEach(function(t){void 0===(e=(t=t).symbols[0].position)&&(e=0),(e=document.createElement("div")).style.transform="rotateY("+u.options.slotYAxis+"deg)",e.classList.add("reel"),n=function(t,e){void 0===e&&(e=0);var n=m(),i=u.options.reelWidth,o=360/h,s=Math.trunc(Math.tan(90/Math.PI-o)*(.5*n)*4),r=s+n/2,a=document.createElement("ul");a.style.height=n+"px",a.style.marginTop=r+"px",a.style.width=i+"px",a.classList.add("strip");for(var l=0;l<h;l++){var d=document.createElement("li"),c=(d.append(l.toString()),f(l,e)),p=h*o-l*o;d.style.background="url("+t.imageSrc+") 0 "+c+"px",d.style.height=n+"px",d.style.width=i+"px",d.style.transform="rotateX("+p+"deg) translateZ("+s+"px)",a.appendChild(d)}return a}(t,t.symbols[0].position),t.element=n,e.appendChild(n);var e,n,t=e;a.appendChild(t)}),t.appendChild(a),this.play=function(){var t;t=l,u.isAnimating||(u.isAnimating=!0,t.call(u))},u}window.slotMachine=function(t,e,n,i){return new SlotMachine(t,e,n,i)},"undefined"!=typeof module&&module.exports&&(module.exports=SlotMachine);